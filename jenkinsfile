pipeline {
    agent any
    stages {
        stage('test') {
            steps {
                script{
                    echo "Stage Test"
                }
            }
        }
        stage('SonarQube analysis') {
            steps {
                script{
                    echo "Stage SonarQube analysis"
                }
            }
        }
        stage('Quality gate') {
            steps {
                script{
                    echo "Stage Quality gate"
                }
            }
        }
        stage('build') {
            agent {
                label 'Linux'
            }
            when {
                expression { BRANCH_NAME ==~ /(master|stage|REL-CL\d)/ }
            }
            steps {
                script{
                    sh """
                        docker run --rm -v \$(pwd):/app -w /app node:17 npm install
                        docker run --rm -v \$(pwd):/app -w /app node:17 npm run-script build
                    """
                    stash includes: 'dist/app-qv-devops', name: 'app'
                }
            }
        }
        stage('deploy') {
            agent {
                label 'Linux'
            }
            steps {
                script{
                    unstash 'app'

                    sh"""
                        mv app/* ../prueba-concepto/cel1
                    """
                    
                }
            }
        }
    }
}